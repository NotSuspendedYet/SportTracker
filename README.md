# SportTracker Telegram Bot

–ë—ç–∫–µ–Ω–¥ –Ω–∞ Kotlin (Ktor, Exposed, Telegram Bot DSL) –¥–ª—è —Ç—Ä–µ–∫–∏–Ω–≥–∞ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –Ω–∞ Render

### 1. –°–æ–∑–¥–∞–π—Ç–µ PostgreSQL –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- –í Render: **Dashboard ‚Üí New ‚Üí PostgreSQL**
- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (host, db, user, password)

### 2. –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ Backend
- **Dashboard ‚Üí New ‚Üí Web Service**
- Source: –≤–∞—à GitHub-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å —ç—Ç–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º
- Build Command: `./gradlew :bot:installDist`
- Start Command: –Ω–µ –Ω—É–∂–µ–Ω (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Dockerfile)
- Environment ‚Üí Add Environment Variables:
  - `BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞
  - `DATABASE_URL` ‚Äî —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î (internal –∏–ª–∏ external, —Ñ–æ—Ä–º–∞—Ç: `postgresql://user:password@host:port/db`)
  - `PORT` ‚Äî `8080` (Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ø–æ—Ä—Ç)
- Region: Europe –∏–ª–∏ –±–ª–∏–∂–∞–π—à–∏–π –∫ –≤–∞–º
- Dockerfile –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Telegram Webhook (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- Render –≤—ã–¥–∞—Å—Ç –≤–∞–º –ø—É–±–ª–∏—á–Ω—ã–π URL (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://sporttracker.onrender.com`)
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å polling (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), –ª–∏–±–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å webhook —á–µ—Ä–µ–∑ BotFather:
  - –î–ª—è polling: —É–¥–∞–ª–∏—Ç–µ webhook (—Å–º. FAQ –Ω–∏–∂–µ)
  - –î–ª—è webhook: —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ endpoint –∏ –ø—Ä–æ–ø–∏—à–∏—Ç–µ –µ–≥–æ —á–µ—Ä–µ–∑ `/setwebhook`

---

## üóÇ –ö–∞—Ä—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
SportTracker/
‚îú‚îÄ‚îÄ bot/                # UI-—Å–ª–æ–π, Ktor + Telegram Bot DSL
‚îÇ   ‚îú‚îÄ‚îÄ src/main/kotlin/BotApplication.kt   # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥, –∑–∞–ø—É—Å–∫ Ktor
‚îÇ   ‚îî‚îÄ‚îÄ src/main/resources/
‚îÇ       ‚îú‚îÄ‚îÄ application.conf                # –ö–æ–Ω—Ñ–∏–≥ Ktor
‚îÇ       ‚îî‚îÄ‚îÄ logback.xml                     # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ build.gradle.kts                    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ bot-—Å–ª–æ—è
‚îú‚îÄ‚îÄ domain/            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, —Å—É—â–Ω–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ src/main/kotlin/Entities.kt         # data-–∫–ª–∞—Å—Å—ã: User, Exercise, Workout, Set
‚îÇ   ‚îî‚îÄ‚îÄ src/main/kotlin/WorkoutParser.kt    # –ü–∞—Ä—Å–µ—Ä –≤–≤–æ–¥–∞ –ø–æ–¥—Ö–æ–¥–æ–≤ (12x3@50, 15x2)
‚îÇ   ‚îî‚îÄ‚îÄ build.gradle.kts                    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ domain-—Å–ª–æ—è
‚îú‚îÄ‚îÄ data/              # –°–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º (Exposed, PostgreSQL)
‚îÇ   ‚îú‚îÄ‚îÄ src/main/kotlin/DatabaseTables.kt   # –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü Exposed
‚îÇ   ‚îú‚îÄ‚îÄ src/main/kotlin/DatabaseFactory.kt  # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ src/main/kotlin/Repositories.kt     # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ users, exercises, workouts
‚îÇ   ‚îú‚îÄ‚îÄ src/main/kotlin/SetRepository.kt    # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è sets (–ø–æ–¥—Ö–æ–¥–æ–≤)
‚îÇ   ‚îî‚îÄ‚îÄ build.gradle.kts                    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ data-—Å–ª–æ—è
‚îú‚îÄ‚îÄ build.gradle.kts    # –ö–æ—Ä–Ω–µ–≤–æ–π gradle, –æ–±—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ settings.gradle.kts # –ú–æ–¥—É–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ gradle.properties   # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ gradle
‚îú‚îÄ‚îÄ .gitignore          # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è git
‚îú‚îÄ‚îÄ Dockerfile          # –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤ Docker/Render
‚îî‚îÄ‚îÄ README.md           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É
```

---

## üìö –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤

- **bot/BotApplication.kt** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª, –≥–¥–µ:
  - –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è Ktor-—Å–µ—Ä–≤–µ—Ä
  - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è Telegram-–±–æ—Ç
  - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –∫–æ–º–∞–Ω–¥: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è, –∑–∞–ø–∏—Å—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, –æ—Ç—á—ë—Ç, —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞
- **domain/Entities.kt** ‚Äî data-–∫–ª–∞—Å—Å—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π, —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫, –ø–æ–¥—Ö–æ–¥–æ–≤
- **domain/WorkoutParser.kt** ‚Äî –ø–∞—Ä—Å–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ –ø–æ–¥—Ö–æ–¥–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 12x3@50)
- **data/DatabaseTables.kt** ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü users, exercises, workouts, sets —á–µ—Ä–µ–∑ Exposed ORM
- **data/DatabaseFactory.kt** ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL, —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
- **data/Repositories.kt, SetRepository.kt** ‚Äî CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
- **bot/application.conf, logback.xml** ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Ktor –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- **Dockerfile** ‚Äî multi-stage build –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ Render –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ Docker

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
- ‚ûï –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
- üèãÔ∏è –ó–∞–ø–∏—Å–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
- üìä –û—Ç—á—ë—Ç (–∑–∞ –Ω–µ–¥–µ–ª—é, –º–µ—Å—è—Ü, –≤—Å—ë –≤—Ä–µ–º—è)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∏ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ (TODO)

---

## –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

```sh
./gradlew :bot:run
```

## –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

```sh
docker build -t sporttracker .
docker run -e BOT_TOKEN=... -e DATABASE_URL=... -p 8080:8080 sporttracker
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞
- `DATABASE_URL` ‚Äî —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL (–Ω–∞–ø—Ä–∏–º–µ—Ä, postgresql://user:password@host:port/db)
- `PORT` ‚Äî –ø–æ—Ä—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8080)

## –ú–∏–≥—Ä–∞—Ü–∏–∏
–¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ.

---

## FAQ –∏ —Ç–∏–ø–æ–≤—ã–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ –Ω–∞ Render

### 1. –û—à–∏–±–∫–∞: `Can't resolve dialect for connection: postgresql://...`
**–ü—Ä–∏—á–∏–Ω–∞:** Render –≤—ã–¥–∞—ë—Ç DATABASE_URL –≤ —Ñ–æ—Ä–º–∞—Ç–µ, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç JDBC/Exposed.
**–†–µ—à–µ–Ω–∏–µ:** –í –ø—Ä–æ–µ–∫—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–µ—Ä DATABASE_URL, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –µ–≥–æ –≤ –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ü—Ä–æ—Å—Ç–æ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∫–∞–∫ –µ—Å—Ç—å (internal –∏–ª–∏ external URL Render).

### 2. –û—à–∏–±–∫–∞: `Unable to parse URL jdbc:postgresql://user:password@host:port/db`
**–ü—Ä–∏—á–∏–Ω–∞:** JDBC —Ç—Ä–µ–±—É–µ—Ç user –∏ password –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∞ –Ω–µ –≤ user:password@.
**–†–µ—à–µ–Ω–∏–µ:** –í –ø—Ä–æ–µ–∫—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–∞—Ä—Å–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç URL –≤ —Ñ–æ—Ä–º–∞—Ç `jdbc:postgresql://host:port/db?user=...&password=...`.

### 3. –û—à–∏–±–∫–∞: `Usage: java [options] <mainclass> [args...]`
**–ü—Ä–∏—á–∏–Ω–∞:** –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ Gradle (`/app/bin/bot`) –Ω–µ –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Docker/Render.
**–†–µ—à–µ–Ω–∏–µ:** –í Dockerfile –∑–∞–ø—É—Å–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `java -classpath "lib/*" bot.BotApplicationKt`.

### 4. –û—à–∏–±–∫–∞: `Module function cannot be found for the fully qualified name ...`
**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Ktor EngineMain –≤–º–µ—Å—Ç–æ —Å–≤–æ–µ–π —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞.
**–†–µ—à–µ–Ω–∏–µ:** –í Dockerfile —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø—É—Å–∫ –≤–∞—à–µ–≥–æ main-–∫–ª–∞—Å—Å–∞: `bot.BotApplicationKt`.

### 5. –û—à–∏–±–∫–∞: `409 Conflict: can't use getUpdates method while webhook is active; use deleteWebhook to delete the webhook first`
**–ü—Ä–∏—á–∏–Ω–∞:** –£ –±–æ—Ç–∞ –≤ Telegram —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω webhook, –∞ backend –ø—ã—Ç–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ä–µ–∂–∏–º–µ polling.
**–†–µ—à–µ–Ω–∏–µ:**
- –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:  
  `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/deleteWebhook`
- –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ polling –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### 6. –û—à–∏–±–∫–∞: Exited with status 128
**–ü—Ä–∏—á–∏–Ω–∞:** –û–±—ã—á–Ω–æ —ç—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ —Å–∫—Ä–∏–ø—Ç.
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∑–∞–¥–∞–Ω—ã –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`BOT_TOKEN`, `DATABASE_URL`, `PORT`).
- –í Dockerfile –¥–æ–±–∞–≤–ª–µ–Ω `chmod +x /app/bin/bot`, –Ω–æ –∑–∞–ø—É—Å–∫ –≤—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ java.

### 7. –ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–æ–≤ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ?
**–†–µ—à–µ–Ω–∏–µ:**
- –í Dockerfile –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã `ls -l /app`, `ls -l /app/bin`, `ls -l /app/lib` –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ –ª–æ–≥–∞—Ö Render.

---

## TODO
- –í—ã–±–æ—Ä —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –ø–æ –Ω–æ–º–µ—Ä—É
- –ö–Ω–æ–ø–∫–∏ Telegram –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥
- –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞ –≤ Redis
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ (cron) 